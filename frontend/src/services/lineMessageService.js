// LINE Message Service - Handles creation of various LINE message formats

export class LineMessageService {
  
  // Create order confirmation Flex Message
  static createOrderConfirmationMessage(orderData, cart, totalItems, totalPrice, shippingFee = null) {
    return {
      type: "bubble",
      header: {
        type: "box",
        layout: "vertical",
        contents: [
          {
            type: "text",
            text: "Â¶ôÂ™ΩÂ™ΩÊûúÂúí",
            weight: "bold",
            size: "xl",
            color: "#FF6B35"
          },
          {
            type: "text",
            text: "Ë®ÇÂñÆÁ¢∫Ë™çÈÄöÁü•",
            
          },
          this._createOrderNumberSection(orderData.orderNumber),
        ],
        backgroundColor: "#FFF8F0",
        paddingAll: "20px"
      },
      body: {
        type: "box",
        layout: "vertical",
        contents: [
          this._createSeparator(),
          this._createSenderInfoSection(orderData),
          this._createSeparator(),
          this._createRecipientInfoSection(orderData),
          this._createSeparator(),
          this._createOrderItemsSection(cart, totalItems, totalPrice, shippingFee),
          this._createSeparator(),
          this._createBankAccountSection(),
        ]
      },
      footer: {
        type: "box",
        layout: "vertical",
        contents: [
          {
            type: "text",
            text: "ÊÑüË¨ùÊÇ®ÁöÑË®ÇË≥ºÔºÅÊàëÂÄëÊúÉÂú®Êî∂Âà∞ÂåØÊ¨æÂæå1~3ÂÄãÂ∑•‰ΩúÂ§©Âá∫Ë≤®„ÄÇ",
            size: "sm",
            color: "#666666",
            align: "center",
            wrap: true
          },
          {
            type: "text",
            text: "Â¶ÇÊúâÂïèÈ°åË´ãÈÄèÈÅéÂÆòÊñπÂ∏≥ËôüËÅØÁµ°ÊàëÂÄëÔºÅ",
            size: "xs",
            color: "#999999",
            align: "center",
            margin: "sm"
          }
        ],
        backgroundColor: "#FFF8F0",
        paddingAll: "12px"
      }
    };
  }

  // Create simple text order confirmation
  static createOrderConfirmationText(orderData, cart, totalItems, totalPrice, shippingFee = null) {
    return `üçê Â¶ôÂ™ΩÂ™ΩÊûúÂúíË©¢ÂÉπÂñÆÁ¢∫Ë™ç

    Ë©¢ÂÉπÂñÆÁ∑®ËôüÔºö${orderData.orderNumber}

    ÂØÑ‰ª∂‰∫∫Ôºö${orderData.senderName} (${orderData.senderPhone})
    ÂØÑ‰ª∂Âú∞ÂùÄÔºö${orderData.senderAddress}

    Êî∂‰ª∂‰∫∫Ôºö${orderData.receiverName} (${orderData.receiverPhone})
    Êî∂‰ª∂Âú∞ÂùÄÔºö${orderData.receiverAddress}

    Ë®ÇË≥ºÂïÜÂìÅÔºö
    ${cart.map(item => `‚Ä¢ ${item.grade} x ${item.cartQuantity}Áõí - NT$${(item.price * item.cartQuantity).toLocaleString()}`).join('\n')}

    Â∞èË®àÔºöNT$${(totalPrice - (shippingFee || 0)).toLocaleString()}${shippingFee !== null ? `
    ÈÅãË≤ªÔºö${shippingFee === 0 ? 'ÂÖçÈÅãË≤ª' : `NT$${shippingFee.toLocaleString()}`}` : ''}
    Á∏ΩË®àÔºö${totalItems}Áõí - NT$${totalPrice.toLocaleString()}

    üí∞ ‰ªòÊ¨æÊñπÂºè ËΩâÂ∏≥ÂåØÊ¨æ/ÁèæÈáëÊîØ‰ªò
    ‰∏≠ËèØÈÉµÊîø(‰ª£Á¢º700)
    ÂçìËò≠ÈÉµÂ±Ä
    Êà∂ÂêçÔºöÂäâËä≥Â¶ô
    Â∏≥ËôüÔºö0291377-0159424

    ‚Äª ÂåØÊ¨æÂÆåÊàêÂæåÔºåË´ãÂãôÂøÖÂëäÁü•
    „ÄåÂåØÊ¨æÂ∏≥ËôüÊú´5Á¢º„ÄçÂèä„ÄåÂåØÊ¨æÈáëÈ°ç„Äç„ÄÇ

    üìã ÂæåÁ∫åÊµÅÁ®ãË™™ÊòéÔºö
    1Ô∏è‚É£ ÊàëÂÄëÊúÉÁ´ãÂç≥ÁÇ∫ÊÇ®Á¢∫Ë™çÂïÜÂìÅÂ∫´Â≠ò
    2Ô∏è‚É£ Á¢∫Ë™çÂ∫´Â≠òÂæåÊúÉÊèê‰æõ‰ªòÊ¨æÊñπÂºèË≥áË®ä
    3Ô∏è‚É£ ÂêåÊôÇÂØÑÈÄÅÊúÄÁµÇÁöÑË®ÇÂñÆÁ¢∫Ë™çË°®

    ‚ö†Ô∏è ÈáçË¶ÅÊèêÈÜíÔºöÊ≠§ÁÇ∫Ë©¢ÂÉπÂñÆÔºå‰∏çÊúÉÁ´ãÂç≥Êâ£Ê¨æ

    ÊÑüË¨ùÊÇ®ÁöÑË©¢ÂÉπÔºÅÊàëÂÄëÊúÉÁõ°Âø´ÁÇ∫ÊÇ®Á¢∫Ë™çÂ∫´Â≠ò„ÄÇ
    Â¶ÇÊúâÂïèÈ°åË´ãËÅØÁµ°Ôºö0910-567118`;
  }

  // Private helper methods
  static _createOrderNumberSection(orderNumber) {
    return {
      type: "text",
      text: `Ë®ÇÂñÆÁ∑®ËôüÔºö${orderNumber}`,
      weight: "bold",
      size: "md",
      color: "#333333",
      margin: "md"
    };
  }

  static _createSeparator() {
    return {
      type: "separator",
      margin: "md"
    };
  }

  static _createSenderInfoSection(orderData) {
    return {
      type: "box",
      layout: "vertical",
      margin: "md",
      contents: [
        {
          type: "text",
          text: "ÂØÑ‰ª∂Ë≥áË®ä",
          weight: "bold",
          size: "sm",
          color: "#FF6B35"
        },
        {
          type: "text",
          text: `ÂßìÂêçÔºö${orderData.senderName}`,
          size: "sm",
          color: "#555555",
          margin: "xs"
        },
        {
          type: "text",
          text: `ÈõªË©±Ôºö${orderData.senderPhone}`,
          size: "sm",
          color: "#555555",
          margin: "xs"
        },
        {
          type: "text",
          text: `Âú∞ÂùÄÔºö${orderData.senderAddress}`,
          size: "sm",
          color: "#555555",
          margin: "xs",
          wrap: true
        }
      ]
    };
  }

  static _createRecipientInfoSection(orderData) {
    return {
      type: "box",
      layout: "vertical",
      margin: "md",
      contents: [
        {
          type: "text",
          text: "Êî∂‰ª∂Ë≥áË®ä",
          weight: "bold",
          size: "sm",
          color: "#FF6B35"
        },
        {
          type: "text",
          text: `ÂßìÂêçÔºö${orderData.receiverName}`,
          size: "sm",
          color: "#555555",
          margin: "xs"
        },
        {
          type: "text",
          text: `ÈõªË©±Ôºö${orderData.receiverPhone}`,
          size: "sm",
          color: "#555555",
          margin: "xs"
        },
        {
          type: "text",
          text: `Âú∞ÂùÄÔºö${orderData.receiverAddress}`,
          size: "sm",
          color: "#555555",
          margin: "xs",
          wrap: true
        }
      ]
    };
  }

  static _createOrderItemsSection(cart, totalItems, totalPrice, shippingFee = null) {
    const subtotal = shippingFee !== null ? totalPrice - shippingFee : totalPrice;
    
    const contents = [
      {
        type: "text",
        text: "Ë®ÇË≥ºÂïÜÂìÅ",
        weight: "bold",
        size: "sm",
        color: "#FF6B35"
      },
      ...cart.map(item => this._createOrderItemRow(item)),
      this._createSeparator()
    ];

    // Add subtotal if shipping fee is available
    if (shippingFee !== null) {
      contents.push(this._createSubtotalRow(subtotal));
      contents.push(this._createShippingRow(shippingFee));
      contents.push(this._createSeparator());
    }

    contents.push(this._createTotalRow(totalItems, totalPrice));

    return {
      type: "box",
      layout: "vertical",
      margin: "md",
      contents: contents
    };
  }

  static _createOrderItemRow(item) {
    return {
      type: "box",
      layout: "horizontal",
      contents: [
        {
          type: "text",
          text: item.grade,
          size: "sm",
          color: "#555555",
          flex: 3
        },
        {
          type: "text",
          text: `${item.cartQuantity}Áõí`,
          size: "sm",
          color: "#555555",
          align: "end",
          flex: 1
        },
        {
          type: "text",
          text: `NT$${(item.price * item.cartQuantity).toLocaleString()}`,
          size: "sm",
          color: "#333333",
          align: "end",
          weight: "bold",
          flex: 2
        }
      ],
      margin: "xs"
    };
  }

  static _createSubtotalRow(subtotal) {
    return {
      type: "box",
      layout: "horizontal",
      contents: [
        {
          type: "text",
          text: "ÂïÜÂìÅÂ∞èË®à",
          size: "sm",
          color: "#555555"
        },
        {
          type: "text",
          text: `NT$${subtotal.toLocaleString()}`,
          size: "sm",
          color: "#333333",
          align: "end",
          weight: "bold"
        }
      ],
      margin: "xs"
    };
  }

  static _createShippingRow(shippingFee) {
    return {
      type: "box",
      layout: "horizontal",
      contents: [
        {
          type: "text",
          text: "ÈÅãË≤ª",
          size: "sm",
          color: "#555555"
        },
        {
          type: "text",
          text: shippingFee === 0 ? "ÂÖçÈÅãË≤ª" : `NT$${shippingFee.toLocaleString()}`,
          size: "sm",
          color: shippingFee === 0 ? "#4CAF50" : "#333333",
          align: "end",
          weight: "bold"
        }
      ],
      margin: "xs"
    };
  }

  static _createTotalRow(totalItems, totalPrice) {
    return {
      type: "box",
      layout: "horizontal",
      contents: [
        {
          type: "text",
          text: `ÂÖ± ${totalItems} Áõí`,
          size: "md",
          color: "#333333",
          weight: "bold"
        },
        {
          type: "text",
          text: `NT$${totalPrice.toLocaleString()}`,
          size: "md",
          color: "#FF6B35",
          align: "end",
          weight: "bold"
        }
      ],
      margin: "md"
    };
  }

  static _createBankAccountSection() {
    return {
      type: "box",
      layout: "vertical",
      margin: "md",
      contents: [
        {
          type: "text",
          text: "üí∞ ‰ªòÊ¨æÊñπÂºè ËΩâÂ∏≥ÂåØÊ¨æ/ÁèæÈáëÊîØ‰ªò",
          weight: "bold",
          size: "sm",
          color: "#FF6B35"
        },
        {
          type: "box",
          layout: "vertical",
          contents: [
            {
              type: "text",
              text: "‰∏≠ËèØÈÉµÊîø(‰ª£Á¢º700)",
              size: "sm",
              color: "#333333",
              margin: "xs",
              weight: "bold"
            },
            {
              type: "text",
              text: "ÂçìËò≠ÈÉµÂ±Ä",
              size: "sm",
              color: "#555555",
              margin: "xs"
            },
            {
              type: "text",
              text: "Êà∂ÂêçÔºöÂäâËä≥Â¶ô",
              size: "sm",
              color: "#555555",
              margin: "xs"
            },
            {
              type: "text",
              text: "Â∏≥ËôüÔºö0291377-0159424",
              size: "sm",
              color: "#333333",
              margin: "xs",
              weight: "bold"
            }
          ],
          backgroundColor: "#FFF8F0",
          paddingAll: "12px",
          cornerRadius: "8px",
          margin: "sm"
        },
        {
          type: "text",
          text: "‚Äª ÂåØÊ¨æÂÆåÊàêÂæåÔºåË´ãÂãôÂøÖÂëäÁü•\n„ÄåÂåØÊ¨æÂ∏≥ËôüÊú´5Á¢º„ÄçÂèä„ÄåÂåØÊ¨æÈáëÈ°ç„Äç„ÄÇ",
          size: "xs",
          color: "#E65100",
          wrap: true,
          margin: "sm"
        }
      ]
    };
  }

  static _createInquirementSection() {
    return {
      type: "box",
      layout: "vertical",
      spacing: "md",
      contents: [
        {
          type: "text",
          text: "üìã ÂæåÁ∫åÊµÅÁ®ãË™™ÊòéÔºö",
          weight: "bold",
          size: "md",
          color: "#FF6B35"
        },
        {
          type: "box",
          layout: "vertical",
          spacing: "sm",
          margin: "md",
          contents: [
            {
              type: "text",
              text: "1Ô∏è‚É£ ÊàëÂÄëÊúÉÁ´ãÂç≥ÁÇ∫ÊÇ®Á¢∫Ë™çÂïÜÂìÅÂ∫´Â≠ò",
              size: "sm",
              color: "#666666",
              wrap: true
            },
            {
              type: "text",
              text: "2Ô∏è‚É£ Á¢∫Ë™çÂ∫´Â≠òÂæåÊúÉÊèê‰æõ‰ªòÊ¨æÊñπÂºèË≥áË®ä",
              size: "sm",
              color: "#666666",
              wrap: true
            },
            {
              type: "text",
              text: "3Ô∏è‚É£ ÂêåÊôÇÂØÑÈÄÅÊúÄÁµÇÁöÑË®ÇÂñÆÁ¢∫Ë™çË°®",
              size: "sm",
              color: "#666666",
              wrap: true
            }
          ]
        },
        {
          type: "separator",
          margin: "md"
        },
        {
          type: "box",
          layout: "horizontal",
          spacing: "sm",
          margin: "md",
          contents: [
            {
              type: "text",
              text: "‚ö†Ô∏è",
              size: "sm",
              flex: 0
            },
            {
              type: "text",
              text: "ÈáçË¶ÅÊèêÈÜíÔºöÊ≠§ÁÇ∫Ë©¢ÂÉπÂñÆÔºå‰∏çÊúÉÁ´ãÂç≥Êâ£Ê¨æ",
              size: "sm",
              color: "#FF6B35",
              weight: "bold",
              wrap: true,
              flex: 1
            }
          ]
        }
      ]
    };
  }

  // Create other message types
  static createWelcomeMessage(userName) {
    return {
      type: "bubble",
      body: {
        type: "box",
        layout: "vertical",
        contents: [
          {
            type: "text",
            text: `Ê≠°Ëøé ${userName}ÔºÅ`,
            weight: "bold",
            size: "lg",
            color: "#FF6B35"
          },
          {
            type: "text",
            text: "ÊÑüË¨ùÊÇ®‰ΩøÁî®Â¶ôÂ™ΩÂ™ΩÊûúÂúíË®ÇË≥ºÁ≥ªÁµ±",
            size: "sm",
            color: "#666666",
            margin: "md",
            wrap: true
          }
        ]
      }
    };
  }

  static createTestMessage() {
    return {
      type: "bubble",
      body: {
        type: "box",
        layout: "vertical",
        contents: [
          {
            type: "text",
            text: "üçê Ê∏¨Ë©¶Ë®äÊÅØ",
            weight: "bold",
            size: "lg",
            color: "#FF6B35"
          },
          {
            type: "text",
            text: "ÈÄôÊòØ‰æÜËá™Â¶ôÂ™ΩÂ™ΩÊûúÂúíÁöÑÊ∏¨Ë©¶Ë®äÊÅØÔºÅÁ≥ªÁµ±ÈÅã‰ΩúÊ≠£Â∏∏„ÄÇ",
            size: "sm",
            color: "#666666",
            margin: "md",
            wrap: true
          }
        ]
      }
    };
  }
}